<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö Live Video Feed</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1e1e1e;
            color: white;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .video-container {
            background: #2d2d2d;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .video-stream {
            width: 100%;
            max-width: 800px;
            height: auto;
            border: 2px solid #444;
            border-radius: 8px;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .status.success { background: #4CAF50; }
        .status.error { background: #f44336; }
        .status.warning { background: #ff9800; }
        .controls {
            margin: 20px 0;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé• ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Live Video Feed</h1>
        
        <div class="video-container">
            <h2>üìπ Video Stream</h2>
            <img id="videoStream" class="video-stream" 
                 src="http://localhost:5000/video_feed" 
                 alt="Live Video Feed"
                 onerror="handleVideoError(this)"
                 onload="handleVideoLoad(this)">
            
            <div id="videoStatus" class="status warning">
                üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠...
            </div>
        </div>
        
        <div class="controls">
            <button onclick="refreshVideo()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠</button>
            <button onclick="checkCameraStatus()">üìä ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
            <button onclick="restartCamera()">üîå ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
        </div>
        
        <div id="cameraInfo" class="video-container">
            <h2>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡πâ‡∏≠‡∏á</h2>
            <div id="cameraStatus">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
        </div>
        
        <div class="video-container">
            <h2>üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h2>
            <ul>
                <li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢</li>
                <li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö IP Address ‡πÅ‡∏•‡∏∞ Port ‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á</li>
                <li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö username/password</li>
                <li>‡∏•‡∏≠‡∏á‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏Å‡∏•‡πâ‡∏≠‡∏á</li>
            </ul>
        </div>
    </div>

    <script>
        function handleVideoError(img) {
            document.getElementById('videoStatus').innerHTML = '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠‡πÑ‡∏î‡πâ';
            document.getElementById('videoStatus').className = 'status error';
            console.error('Video stream error');
        }
        
        function handleVideoLoad(img) {
            document.getElementById('videoStatus').innerHTML = '‚úÖ ‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
            document.getElementById('videoStatus').className = 'status success';
            console.log('Video stream loaded successfully');
        }
        
        function refreshVideo() {
            const img = document.getElementById('videoStream');
            const currentSrc = img.src;
            img.src = '';
            setTimeout(() => {
                img.src = currentSrc + '?t=' + new Date().getTime();
            }, 100);
            
            document.getElementById('videoStatus').innerHTML = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠...';
            document.getElementById('videoStatus').className = 'status warning';
        }
        
        async function checkCameraStatus() {
            try {
                const response = await fetch('http://localhost:5000/api/camera/status');
                const data = await response.json();
                
                let statusHtml = '<h3>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡πâ‡∏≠‡∏á</h3>';
                statusHtml += `<p>üì∑ ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ${data.camera_available ? '‚úÖ ‡πÉ‡∏ä‡πà' : '‚ùå ‡πÑ‡∏°‡πà'}</p>`;
                statusHtml += `<p>üîó ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß: ${data.camera_connected ? '‚úÖ ‡πÉ‡∏ä‡πà' : '‚ùå ‡πÑ‡∏°‡πà'}</p>`;
                statusHtml += `<p>üì∫ Video Source: ${data.video_source}</p>`;
                statusHtml += `<p>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${data.status}</p>`;
                
                document.getElementById('cameraStatus').innerHTML = statusHtml;
            } catch (error) {
                document.getElementById('cameraStatus').innerHTML = `‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ: ${error.message}`;
            }
        }
        
        async function restartCamera() {
            try {
                const response = await fetch('http://localhost:5000/api/camera/restart', {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    setTimeout(refreshVideo, 2000);
                } else {
                    alert(`‚ùå ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${data.message}`);
                }
            } catch (error) {
                alert(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
            }
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        window.onload = function() {
            setTimeout(checkCameraStatus, 1000);
        };
    </script>
</body>
</html>
