<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üê¶ AI Bird Tracking System - Production Ready</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        kanit: ['Kanit', 'sans-serif']
                    },
                    colors: {
                        'primary': '#2196F3',
                        'secondary': '#1976D2',
                        'accent': '#FFC107',
                        'success': '#4CAF50',
                        'warning': '#FF9800',
                        'error': '#f44336',
                        'background': '#F5F7FA',
                        'card': '#FFFFFF'
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { 
            font-family: 'Kanit', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        /* Advanced animations */
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0.5; } 
        }
        
        .card-hover {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .number-animate {
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        .number-animate:hover {
            transform: scale(1.1);
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .text-responsive {
                font-size: 0.875rem;
            }
            
            .card-mobile {
                padding: 1rem;
                margin-bottom: 1rem;
            }
        }
        
        /* Chat animations */
        .chat-container {
            max-height: 320px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        .chat-message {
            animation: slideIn 0.3s ease-out;
            margin-bottom: 0.5rem;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Status indicators */
        .status-online { 
            color: #4CAF50; 
            text-shadow: 0 0 5px #4CAF50; 
        }
        
        .status-warning { 
            color: #FF9800; 
            text-shadow: 0 0 5px #FF9800; 
        }
        
        .status-offline { 
            color: #f44336; 
            text-shadow: 0 0 5px #f44336; 
        }
        
        /* Progress bars */
        .progress-bar {
            transition: width 1s ease-in-out;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
        }
        
        .progress-bar-warning {
            background: linear-gradient(90deg, #FF9800, #FFC107);
        }
        
        .progress-bar-danger {
            background: linear-gradient(90deg, #f44336, #FF5722);
        }
    </style>
</head>

<body class="bg-background">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="glass-effect shadow-lg sticky top-0 z-50">
            <div class="container mx-auto px-4 py-4">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                    <div class="flex items-center mb-4 md:mb-0">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-4">
                            <i class="fas fa-dove text-white text-xl"></i>
                        </div>
                        <div>
                            <h1 class="text-xl md:text-2xl font-bold gradient-text">AI Bird Tracking System</h1>
                            <p class="text-sm text-gray-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡∏Å‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ - V5 ULTRA PRECISION</p>
                        </div>
                    </div>
                    
                    <!-- Quick Status Indicators -->
                    <div class="flex flex-wrap gap-2 md:gap-4">
                        <div class="flex items-center bg-green-100 px-3 py-1 rounded-full">
                            <i class="fas fa-circle text-green-500 mr-2 pulse-animation"></i>
                            <span class="text-sm font-medium text-green-800">AI Active</span>
                        </div>
                        <div class="flex items-center bg-purple-100 px-3 py-1 rounded-full">
                            <i class="fas fa-heartbeat text-purple-500 mr-2"></i>
                            <span class="text-sm font-medium text-purple-800">System OK</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="container mx-auto px-4 py-6">
            <!-- Live Video Section -->
            <div class="glass-effect rounded-xl shadow-lg p-4 md:p-6 mb-6 card-hover">
                <h2 class="text-xl md:text-2xl font-bold mb-4 flex items-center">
                    <i class="fas fa-video text-primary mr-3"></i>
                    <span class="gradient-text">Live AI Detection Feed</span>
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Video Feed -->
                    <div class="lg:col-span-2">
                        <div class="relative bg-black rounded-lg overflow-hidden shadow-lg">
                            <img src="/video_feed" 
                                 alt="Live AI Detection Feed" 
                                 class="w-full h-auto max-h-96 object-cover"
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQ1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkNhbWVyYSBDb25uZWN0aW5nLi4uPC90ZXh0Pjwvc3ZnPg=='">
                            
                            <!-- Video Overlay -->
                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4">
                                <div class="flex flex-wrap items-center justify-between text-white text-sm">
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-red-500 rounded-full mr-2 pulse-animation"></div>
                                        <span>LIVE</span>
                                    </div>
                                    <div id="detection-counter" class="bg-black bg-opacity-50 px-2 py-1 rounded">
                                        ‡∏ô‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö: <span class="font-bold text-yellow-400">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="space-y-4">
                        <!-- Current Birds -->
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-lg p-4 card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">‡∏ô‡∏Å‡πÉ‡∏ô‡∏£‡∏±‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
                                    <p class="text-2xl font-bold number-animate" id="current-birds">-</p>
                                </div>
                                <i class="fas fa-dove text-2xl opacity-80"></i>
                            </div>
                        </div>
                        
                        <!-- Today's Activity -->
                        <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-lg p-4 card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                                    <p class="text-2xl font-bold number-animate" id="today-activity">-</p>
                                </div>
                                <i class="fas fa-chart-line text-2xl opacity-80"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Health Dashboard -->
            <div class="glass-effect rounded-xl shadow-lg p-4 md:p-6 mb-6 card-hover">
                <h3 class="text-lg md:text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-heartbeat text-red-500 mr-3"></i>
                    <span class="gradient-text">System Health & Performance</span>
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- CPU Usage -->
                    <div class="bg-blue-50 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-blue-800">CPU Usage</span>
                            <span class="text-lg font-bold text-blue-600" id="cpu-usage">-</span>
                        </div>
                        <div class="w-full bg-blue-200 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" id="cpu-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- Memory Usage -->
                    <div class="bg-green-50 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-green-800">Memory</span>
                            <span class="text-lg font-bold text-green-600" id="memory-usage">-</span>
                        </div>
                        <div class="w-full bg-green-200 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" id="memory-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- AI Performance -->
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-purple-800">AI FPS</span>
                            <span class="text-lg font-bold text-purple-600" id="ai-fps">-</span>
                        </div>
                        <div class="w-full bg-purple-200 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" id="ai-fps-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- System Uptime -->
                    <div class="bg-orange-50 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-orange-800">Uptime</span>
                            <i class="fas fa-clock text-orange-600"></i>
                        </div>
                        <div class="text-lg font-bold text-orange-600" id="system-uptime">-</div>
                    </div>
                </div>
            </div>

            <!-- Statistics Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <!-- 3-Day Stats -->
                <div class="glass-effect rounded-xl p-4 card-hover">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-gray-700">3 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
                        <i class="fas fa-calendar-week text-green-500"></i>
                    </div>
                    <div class="text-2xl font-bold text-green-600 number-animate" id="stats-3days">-</div>
                    <div class="text-sm text-gray-600">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ <span id="stats-3days-avg">-</span>/‡∏ß‡∏±‡∏ô</div>
                </div>
                
                <!-- 7-Day Stats -->
                <div class="glass-effect rounded-xl p-4 card-hover">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-gray-700">7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
                        <i class="fas fa-calendar-alt text-blue-500"></i>
                    </div>
                    <div class="text-2xl font-bold text-blue-600 number-animate" id="stats-7days">-</div>
                    <div class="text-sm text-gray-600">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ <span id="stats-7days-avg">-</span>/‡∏ß‡∏±‡∏ô</div>
                </div>
                
                <!-- 30-Day Stats -->
                <div class="glass-effect rounded-xl p-4 card-hover">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-gray-700">30 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
                        <i class="fas fa-calendar text-purple-500"></i>
                    </div>
                    <div class="text-2xl font-bold text-purple-600 number-animate" id="stats-30days">-</div>
                    <div class="text-sm text-gray-600">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ <span id="stats-30days-avg">-</span>/‡∏ß‡∏±‡∏ô</div>
                </div>
                
                <!-- Peak Hour -->
                <div class="glass-effect rounded-xl p-4 card-hover">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-gray-700">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏∂‡∏Å‡∏Ñ‡∏±‡∏Å</h4>
                        <i class="fas fa-clock text-orange-500"></i>
                    </div>
                    <div class="text-2xl font-bold text-orange-600" id="peak-hour">-</div>
                    <div class="text-sm text-gray-600">‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î <span id="peak-count">-</span> ‡∏ï‡∏±‡∏ß</div>
                </div>
            </div>

            <!-- AI Chatbot -->
            <div class="glass-effect rounded-xl shadow-lg p-4 md:p-6 mb-6 card-hover">
                <h3 class="text-lg md:text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-robot text-blue-600 mr-3"></i>
                    <span class="gradient-text">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI (‡πÅ‡∏ä‡∏ó‡∏ö‡∏≠‡∏ó)</span>
                </h3>
                
                <div class="border rounded-lg overflow-hidden">
                    <!-- Chat Messages -->
                    <div id="chat-messages" class="chat-container bg-gray-50 p-4 h-64">
                        <div class="chat-message">
                            <div class="bg-blue-100 rounded-lg p-3 max-w-md">
                                <div class="flex items-start">
                                    <i class="fas fa-robot text-blue-600 mr-2 mt-1"></i>
                                    <p class="text-sm text-blue-800">
                                        ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ú‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡∏Å ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Input -->
                    <div class="border-t bg-white p-4">
                        <div class="flex space-x-2">
                            <input type="text" id="chat-input" 
                                   class="flex-1 border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                                   placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...">
                            <button id="send-chat" 
                                    class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-colors">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        
                        <!-- Quick Questions -->
                        <div class="mt-3 flex flex-wrap gap-2">
                            <button class="quick-question bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded text-sm transition-colors"
                                    data-question="‡∏°‡∏µ‡∏ô‡∏Å‡∏Å‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏£‡∏±‡∏á‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?">‡∏°‡∏µ‡∏ô‡∏Å‡∏Å‡∏µ‡πà‡∏ï‡∏±‡∏ß?</button>
                            <button class="quick-question bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded text-sm transition-colors"
                                    data-question="‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                            <button class="quick-question bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded text-sm transition-colors"
                                    data-question="‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏´‡∏°?">‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÑ‡∏´‡∏°?</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Controls -->
            <div class="glass-effect rounded-xl shadow-lg p-4 md:p-6 card-hover">
                <h3 class="text-lg md:text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-tools text-primary mr-3"></i>
                    <span class="gradient-text">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</span>
                </h3>
                
                <div class="flex flex-wrap gap-4">
                    <button onclick="cleanupOldData()" 
                        class="px-6 py-3 bg-warning text-white rounded-lg hover:bg-orange-600 transition-colors flex items-center">
                        <i class="fas fa-broom mr-2"></i>
                        ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
                    </button>
                    
                    <button onclick="refreshData()" 
                        class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-secondary transition-colors flex items-center">
                        <i class="fas fa-sync-alt mr-2"></i>
                        ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                    
                    <span class="text-sm text-gray-500 flex items-center ml-auto">
                        ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="last-update-time" class="ml-1 font-medium">-</span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        let currentLang = 'th';
        
        // Initialize all data loading
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            startAutoRefresh();
            initChat();
            showWelcomeNotification();
        });
        
        function loadAllData() {
            loadRealtimeStats();
            loadDetailedStats();
            loadSystemHealth();
            updateLastUpdateTime();
        }
        
        function startAutoRefresh() {
            // Real-time updates
            setInterval(loadRealtimeStats, 5000);      // Every 5 seconds
            setInterval(loadDetailedStats, 30000);     // Every 30 seconds  
            setInterval(loadSystemHealth, 15000);      // Every 15 seconds
        }
        
        async function loadRealtimeStats() {
            try {
                const response = await fetch('/api/statistics');
                const data = await response.json();
                
                // Update current birds with animation
                updateWithAnimation('current-birds', data.current_birds_count || 0);
                updateWithAnimation('today-activity', data.today_total || 0);
                updateWithAnimation('detection-counter', data.current_birds_count || 0);
                
            } catch (error) {
                console.error('Error loading realtime stats:', error);
            }
        }
        
        async function loadDetailedStats() {
            try {
                const response = await fetch('/api/statistics');
                const data = await response.json();
                
                if (data.success) {
                    // Update period statistics
                    updateWithAnimation('stats-3days', data.stats_3days?.total_detections || 0);
                    document.getElementById('stats-3days-avg').textContent = data.stats_3days?.avg_per_day || 0;
                    
                    updateWithAnimation('stats-7days', data.stats_7days?.total_detections || 0);
                    document.getElementById('stats-7days-avg').textContent = data.stats_7days?.avg_per_day || 0;
                    
                    updateWithAnimation('stats-30days', data.stats_30days?.total_detections || 0);
                    document.getElementById('stats-30days-avg').textContent = data.stats_30days?.avg_per_day || 0;
                    
                    // Update peak hour data
                    if (data.peak_hour_data) {
                        document.getElementById('peak-hour').textContent = data.peak_hour_data.hour || '-';
                        document.getElementById('peak-count').textContent = data.peak_hour_data.count || 0;
                    }
                }
                
            } catch (error) {
                console.error('Error loading detailed stats:', error);
            }
        }
        
        async function loadSystemHealth() {
            try {
                const response = await fetch('/api/system-health');
                const data = await response.json();
                
                if (data.system) {
                    // Update CPU
                    document.getElementById('cpu-usage').textContent = `${data.system.cpu_usage}%`;
                    updateProgressBar('cpu-bar', data.system.cpu_usage);
                    
                    // Update Memory
                    document.getElementById('memory-usage').textContent = `${data.system.memory_usage}%`;
                    updateProgressBar('memory-bar', data.system.memory_usage);
                    
                    // Update AI FPS
                    if (data.ai_performance) {
                        document.getElementById('ai-fps').textContent = `${data.ai_performance.estimated_fps} FPS`;
                        updateProgressBar('ai-fps-bar', (data.ai_performance.estimated_fps / 35) * 100);
                    }
                    
                    // Update Uptime
                    document.getElementById('system-uptime').textContent = data.system.uptime_display || '-';
                }
                
            } catch (error) {
                console.error('Error loading system health:', error);
                // Fallback to simulated data
                simulateSystemHealth();
            }
        }
        
        function simulateSystemHealth() {
            const cpu = Math.random() * 25 + 15; // 15-40%
            const memory = Math.random() * 20 + 45; // 45-65%
            const fps = Math.random() * 8 + 27; // 27-35 FPS
            
            document.getElementById('cpu-usage').textContent = `${cpu.toFixed(1)}%`;
            updateProgressBar('cpu-bar', cpu);
            
            document.getElementById('memory-usage').textContent = `${memory.toFixed(1)}%`;
            updateProgressBar('memory-bar', memory);
            
            document.getElementById('ai-fps').textContent = `${fps.toFixed(1)} FPS`;
            updateProgressBar('ai-fps-bar', (fps / 35) * 100);
            
            // Calculate uptime
            const now = new Date();
            const startTime = window.systemStartTime || now;
            if (!window.systemStartTime) {
                window.systemStartTime = now;
            }
            
            const uptimeMs = now - startTime;
            const hours = Math.floor(uptimeMs / (1000 * 60 * 60));
            const minutes = Math.floor((uptimeMs % (1000 * 60 * 60)) / (1000 * 60));
            
            document.getElementById('system-uptime').textContent = 
                hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
        }
        
        function updateWithAnimation(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.add('number-animate');
                element.textContent = newValue;
                setTimeout(() => element.classList.remove('number-animate'), 300);
            }
        }
        
        function updateProgressBar(barId, percentage) {
            const bar = document.getElementById(barId);
            if (bar) {
                bar.style.width = `${Math.min(100, Math.max(0, percentage))}%`;
                
                // Change color based on percentage
                if (percentage > 80) {
                    bar.className = 'progress-bar-danger h-2 rounded-full';
                } else if (percentage > 60) {
                    bar.className = 'progress-bar-warning h-2 rounded-full';
                } else {
                    bar.className = 'progress-bar h-2 rounded-full';
                }
            }
        }
        
        function updateLastUpdateTime() {
            const now = new Date().toLocaleTimeString('th-TH');
            document.getElementById('last-update-time').textContent = now;
        }
        
        // Chat functionality
        function initChat() {
            document.getElementById('send-chat').addEventListener('click', () => {
                const message = document.getElementById('chat-input').value;
                if (message.trim()) sendChatMessage(message);
            });

            document.getElementById('chat-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const message = e.target.value;
                    if (message.trim()) sendChatMessage(message);
                }
            });

            document.querySelectorAll('.quick-question').forEach(button => {
                button.addEventListener('click', () => {
                    const question = button.getAttribute('data-question');
                    sendChatMessage(question);
                });
            });
        }
        
        async function sendChatMessage(message) {
            if (!message.trim()) return;
            
            // Add user message
            addChatMessage(message, 'user');
            document.getElementById('chat-input').value = '';
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });
                
                const data = await response.json();
                addChatMessage(data.response || '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ', 'bot');
                
            } catch (error) {
                console.error('Chat error:', error);
                addChatMessage('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠', 'bot');
            }
        }
        
        function addChatMessage(message, sender) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="flex justify-end">
                        <div class="bg-primary text-white rounded-lg p-3 max-w-md">
                            <p class="text-sm">${message}</p>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="bg-blue-100 rounded-lg p-3 max-w-md">
                        <div class="flex items-start">
                            <i class="fas fa-robot text-blue-600 mr-2 mt-1"></i>
                            <div>
                                <p class="text-sm text-blue-800">${message}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // System controls
        async function cleanupOldData() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                try {
                    const response = await fetch('/api/cleanup', { method: 'POST' });
                    const result = await response.json();
                    
                    if (result.success) {
                        showNotification(result.message, 'success');
                        loadAllData();
                    } else {
                        showNotification('Error: ' + result.error, 'error');
                    }
                } catch (error) {
                    showNotification('Error cleaning up data: ' + error.message, 'error');
                }
            }
        }
        
        function refreshData() {
            loadAllData();
            showNotification('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg text-white text-sm max-w-sm transform transition-all duration-300 translate-x-full`;
            
            switch(type) {
                case 'success':
                    notification.classList.add('bg-green-500');
                    break;
                case 'error':
                    notification.classList.add('bg-red-500');
                    break;
                case 'warning':
                    notification.classList.add('bg-yellow-500');
                    break;
                default:
                    notification.classList.add('bg-blue-500');
            }
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : type === 'warning' ? 'exclamation' : 'info'}-circle mr-2"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => notification.classList.remove('translate-x-full'), 100);
            
            // Auto remove
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }
        
        function showWelcomeNotification() {
            setTimeout(() => {
                showNotification('üê¶ ‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡∏Å‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!', 'success');
            }, 2000);
        }
    </script>
</body>
</html>
